## Socket

```c
#include <sys/socket.h>

// 전화를 하려면 전화기가 필요, 전화기 -> socket
int socket(int domain, int type, int protocol) // 성공 시 파일 디스크립터, 실패 시 -1
/*
domain   : 소켓이 사용할 프로토콜 체계(Protocol Family) 정보 
type     : 소켓의 데이터 전송방식에 대한 정보
protocol : 더 컴퓨터간 통신에 사용되는 프로토콜 정보
*/
```

### Protocol Family

|Name|Protocol Family|
|-|-|
|PF_INET|IPv4 인터넷 프로토콜 체계|
|PF_INET6|IPv6 인터넷 프로토콜 체계|
|PF_LOCAL|로컬 통신을 위한 UNIX 프로토콜 체계|
|PF_PACKET|Low Level 소켓을 위한 프로토콜 체계|
|PF_IPX|IPX 노벨 프로토콜 체계|

실제 소켓이 사용할 최종 프로토콜 정보는 세 번째 인자이지만 이 프로토콜 체계 범위 내에 있다.

### Type

프로토콜의 체계가 결정되었다고 해서 데이터 전송방식까지 결정된 것은 아니다.
PF_INET에 해당하는 프로토콜 체계에도 둘 이상의 데이터 전송방식이 존재한다.
따라서 타입은 **소켓의 데이터 전송방식을 의미한다.**

#### SOCK_STREAM(연결지향형 소켓)

- 중간에 데이터가 소멸되지 않고 목적지로 전송된다.
- 전송 순서대로 데이터가 수신된다.
- 전송되는 데이터의 경계(Boundary)가 존재하지 않는다.
- 소켓 대 소켓의 연결은 반드시 1대1이어야 한다.

-> **신뢰성있는 순차적인 바이트 기반의 연결지향 데이터 전송 방식의 소켓**

두 사람이 공장의 슬라이드 레일을 통해 물건을 보내고 받는 상황을 생각하면 쉽다.

데이터를 송수신하는 소켓은 내부적으로 버퍼, 쉽게 말해서 바이트 배열을 지니며 소켓을 통해 전송되는 데이터는 일단 이 배열에 저장된다.
때문에 수신되었다고 해서 반드시 read 함수를 호출해야 하는 것은 아니다.
이런 이유로 전송되는 데이터의 경계가 존재하지 않는다고 하는 것이다.

>**버퍼가 가득 차면 데이터는 소멸될까?**
>
>read 함수 호출을 통해 읽힌 데이터는 버퍼에서 비워지게 된다.
>read 함수를 호출하기 전에 버퍼가 가득 차게 되면 소켓은 더 이상 데이터를 수신할 수 없다.
>왜냐하면 연결지향형 소켓에서 데이터를 전송하는 영역의 소켓이 자신과 연결된 상태 소켓의 상태를 파악해가면서 데이터를 전송하기 때문이다.
>
>따라서 연결지향형 소켓의 데이터손실은 특별한 경우가 아닌 이상 발생하지 않는다.

#### SOCK_DGRAM(비연결지향형 소켓)

- 전송된 순서에 상관없이 가장 빠른 전송을 지향한다.
- 전송된 데이터는 손실의 우려가 있고, 파손의 우려가 있다.
- 전송되는 데이터의 경계(Boundary)가 존재한다.
- 한 번에 전송할 수 있는 데이터의 크기가 제한된다.

-> **신뢰성과 순차적 데이터 전송을 보장하지 않는, 고속의 데이터 전송을 목적으로 하는 소켓**

엄청난 속도로 이동하는 오토바이 택배 서비스를 생각하면 쉽다.

서로 다른 오토바이에 실려 동일한 목적지를 향하는 두 개의 물건은, 출발 순서와 상관없이 목적지에 도달하게 된다. 뿐만 아니라 손실 및 파손의 우려가 존재한다.
그리고 오토바이에 실어 보낼 수 있는 물건의 크기가 제한되기 때문에 많은 양의 물건을 옮기기 위해서는 나누어 보내야하며 물건 2개가 별도의 오토바이에서 전달하면 받는 사람도 2번에 걸쳐 물건을 수령해야한다.
이러한 전송 특성 때문에 전송되는 데이터의 경계가 존재한다고 하는 것이다.

### Protocol

대부분의 경우 앞에서 본 2개의 인자의 정보로도 프로토콜 결정에 충분한 정보가 되어 이 인자를 0으로 넘겨주어도 원하는 데이터 소켓을 생성할 수 있다.

**하나의 프로토콜 체계 안에 데이터의 전송방식이 동일한 프로토콜이 둘 이상 존재하는 경우에 필요**

```c
// IPv4 인터넷 프로토콜 체계에서 동작하는 연결지향형 데이터 전송 소켓
int tcp_socket = socket(PF_INET, SOCK_STREAM, IPPROTO_TCP );

// IPv4 인터넷 프로토콜 체계에서 동작하는 비연결지향형 데이터 전송 소켓
int udp_socket = socket(PF_INET, SOCK_DGRAM, IPPROTO_UDP );
```